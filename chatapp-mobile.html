<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ChatApp Pro Mobile - Advanced Messaging</title>
    
    <!-- Mobile PWA Meta Tags -->
    <meta name="theme-color" content="#1a73e8">
    <meta name="description" content="Advanced mobile chat application with groups, channels, and bot management">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* MOBILE-FIRST CSS DESIGN */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            height: 100vh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Mobile Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 30px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Auth Screen */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .auth-container {
            background: white;
            border-radius: 25px;
            padding: 30px 25px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            max-width: 380px;
            width: 100%;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: 35px;
        }

        .auth-header i {
            font-size: 55px;
            color: #1a73e8;
            margin-bottom: 20px;
        }

        .auth-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #1a73e8, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .auth-header p {
            color: #666;
            font-size: 16px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            background: #f5f5f5;
            border-radius: 15px;
            padding: 6px;
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .auth-tab.active {
            background: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            color: #1a73e8;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form input {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #eee;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            touch-action: manipulation;
        }

        .auth-form input:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .auth-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #1a73e8, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .auth-btn:active {
            transform: scale(0.98);
        }

        .social-auth {
            margin-top: 25px;
            text-align: center;
        }

        .google-btn {
            width: 100%;
            padding: 16px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .google-btn:active {
            transform: scale(0.98);
        }

        /* Mobile Main App */
        .main-app {
            display: none;
            height: 100vh;
            background: white;
            flex-direction: column;
            position: relative;
        }

        /* Mobile Top Bar */
        .mobile-top-bar {
            background: linear-gradient(45deg, #1a73e8, #764ba2);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 100;
        }

        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 10px;
            touch-action: manipulation;
        }

        .menu-btn:active {
            background: rgba(255, 255, 255, 0.2);
        }

        .app-title {
            font-size: 20px;
            font-weight: 700;
        }

        .top-bar-actions {
            display: flex;
            gap: 10px;
        }

        .top-action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 18px;
            padding: 10px;
            border-radius: 12px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .top-action-btn:active {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Mobile Sidebar Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }

        .mobile-sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background: white;
            z-index: 1001;
            transition: left 0.3s ease;
            box-shadow: 5px 0 20px rgba(0, 0, 0, 0.2);
        }

        .mobile-sidebar.active {
            left: 0;
        }

        .sidebar-header-mobile {
            background: linear-gradient(45deg, #1a73e8, #764ba2);
            color: white;
            padding: 25px 20px;
        }

        .user-profile-mobile {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .avatar-mobile {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .user-info-mobile h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .user-info-mobile p {
            font-size: 14px;
            opacity: 0.9;
        }

        .verification-badge-mobile {
            color: #FFD700;
            font-size: 20px;
            margin-left: 10px;
        }

        .sidebar-actions-mobile {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .mobile-action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 16px;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            touch-action: manipulation;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .mobile-action-btn span {
            font-size: 10px;
        }

        .mobile-action-btn:active {
            background: rgba(255, 255, 255, 0.3);
        }

        .search-bar-mobile {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .search-input-mobile {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            background: #f8f9fa;
        }

        .search-input-mobile:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .chat-list-mobile {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .chat-item-mobile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 20px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid #f1f3f4;
            touch-action: manipulation;
        }

        .chat-item-mobile:active {
            background-color: #f1f3f4;
        }

        .chat-item-mobile.active {
            background-color: #e3f2fd;
            border-left: 4px solid #1a73e8;
        }

        .chat-avatar-mobile {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            object-fit: cover;
        }

        .chat-info-mobile {
            flex: 1;
            min-width: 0;
        }

        .chat-name-mobile {
            font-weight: 600;
            font-size: 17px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-last-message-mobile {
            font-size: 15px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-meta-mobile {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .chat-time-mobile {
            font-size: 12px;
            color: #999;
        }

        .member-count-mobile {
            font-size: 11px;
            color: #666;
            background: #e9ecef;
            padding: 3px 8px;
            border-radius: 12px;
        }

        /* Mobile Chat Area */
        .chat-area-mobile {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 80px);
            position: relative;
        }

        .chat-header-mobile {
            background: white;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .chat-info-header {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .chat-avatar-header {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
        }

        .chat-details h3 {
            font-size: 18px;
            margin-bottom: 3px;
        }

        .chat-status-mobile {
            font-size: 13px;
            color: #666;
        }

        .chat-actions-mobile {
            display: flex;
            gap: 10px;
        }

        .chat-action-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #666;
            font-size: 16px;
            padding: 10px;
            border-radius: 12px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .chat-action-btn:active {
            background: #e9ecef;
        }

        /* Mobile Messages Container */
        .messages-container-mobile {
            flex: 1;
            overflow-y: auto;
            padding: 20px 15px;
            background: #f8f9fa;
            scroll-behavior: smooth;
        }

        .welcome-message-mobile {
            text-align: center;
            color: #666;
            margin-top: 80px;
        }

        .welcome-message-mobile i {
            font-size: 80px;
            color: #ddd;
            margin-bottom: 25px;
        }

        .welcome-message-mobile h2 {
            font-size: 24px;
            margin-bottom: 15px;
            color: #333;
        }

        .message-mobile {
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            animation: messageSlideIn 0.4s ease;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-mobile.sent {
            align-items: flex-end;
        }

        .message-mobile.sent .message-content-mobile {
            background: linear-gradient(45deg, #1a73e8, #764ba2);
            color: white;
            border-radius: 20px 20px 5px 20px;
        }

        .message-mobile.received .message-content-mobile {
            background: white;
            color: #333;
            border-radius: 20px 20px 20px 5px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
        }

        .message-header-mobile {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 13px;
            color: #666;
        }

        .message-mobile.sent .message-header-mobile {
            justify-content: flex-end;
        }

        .message-avatar-mobile {
            width: 28px;
            height: 28px;
            border-radius: 50%;
        }

        .message-sender-mobile {
            font-weight: 600;
        }

        .verified-badge-mobile {
            color: #1da1f2;
            font-size: 16px;
        }

        .message-time-mobile {
            color: #999;
        }

        .message-content-mobile {
            max-width: 85%;
            padding: 15px 18px;
            word-wrap: break-word;
            font-size: 16px;
            line-height: 1.4;
        }

        .message-media-mobile {
            max-width: 100%;
            border-radius: 15px;
            margin-top: 10px;
        }

        /* Mobile Message Input */
        .message-input-area-mobile {
            background: white;
            padding: 15px 20px 25px;
            border-top: 1px solid #eee;
            display: none;
            position: relative;
        }

        .attachment-options-mobile {
            display: none;
            gap: 12px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 15px;
            overflow-x: auto;
        }

        .attach-btn-mobile {
            padding: 12px 18px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            touch-action: manipulation;
        }

        .attach-btn-mobile:active {
            background: #e9ecef;
        }

        .message-input-mobile {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 8px 15px;
        }

        .attach-toggle-mobile {
            background: none;
            border: none;
            color: #666;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            touch-action: manipulation;
        }

        .attach-toggle-mobile:active {
            color: #333;
        }

        .message-text-mobile {
            flex: 1;
            border: none;
            background: none;
            padding: 12px 8px;
            font-size: 16px;
            outline: none;
        }

        .send-btn-mobile {
            background: linear-gradient(45deg, #1a73e8, #764ba2);
            color: white;
            border: none;
            font-size: 18px;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
            touch-action: manipulation;
        }

        .send-btn-mobile:active {
            transform: scale(0.95);
        }

        /* Mobile Modals */
        .modal-mobile {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: flex-end;
            z-index: 2000;
        }

        .modal-content-mobile {
            background: white;
            border-radius: 25px 25px 0 0;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUpModal 0.4s ease-out;
            position: relative;
        }

        @keyframes slideUpModal {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .modal-header-mobile {
            padding: 25px 25px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-header-mobile h2 {
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #333;
        }

        .close-btn-mobile {
            background: #f8f9fa;
            border: none;
            color: #666;
            font-size: 18px;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            width: 45px;
            height: 45px;
            touch-action: manipulation;
        }

        .close-btn-mobile:active {
            background: #e9ecef;
        }

        /* Mobile Admin Panel */
        .admin-tabs-mobile {
            display: flex;
            border-bottom: 1px solid #eee;
            overflow-x: auto;
            padding: 0 25px;
        }

        .admin-tab-mobile {
            flex: 1;
            min-width: 80px;
            padding: 18px 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            touch-action: manipulation;
        }

        .admin-tab-mobile.active {
            color: #1a73e8;
            border-bottom-color: #1a73e8;
        }

        .admin-tab-content-mobile {
            display: none;
            padding: 25px;
        }

        .admin-tab-content-mobile.active {
            display: block;
        }

        .admin-actions-mobile {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .admin-btn-mobile {
            padding: 18px 20px;
            background: linear-gradient(45deg, #1a73e8, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            touch-action: manipulation;
        }

        .admin-btn-mobile:active {
            transform: scale(0.98);
        }

        .verify-btn-mobile {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .revoke-btn-mobile {
            background: linear-gradient(45deg, #dc3545, #fd7e14);
        }

        /* Bot Generator Mobile */
        .bot-generator-mobile {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .bot-generator-mobile h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 20px;
        }

        .bot-generator-mobile label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 16px;
        }

        .bot-generator-mobile input {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 16px;
        }

        /* Form Groups Mobile */
        .form-group-mobile {
            margin-bottom: 25px;
        }

        .form-group-mobile label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .form-group-mobile input,
        .form-group-mobile select,
        .form-group-mobile textarea {
            width: 100%;
            padding: 18px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group-mobile input:focus,
        .form-group-mobile select:focus,
        .form-group-mobile textarea:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .form-group-mobile textarea {
            resize: vertical;
            min-height: 100px;
        }

        .submit-btn-mobile {
            width: 100%;
            padding: 20px;
            background: linear-gradient(45deg, #1a73e8, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            touch-action: manipulation;
        }

        .submit-btn-mobile:active {
            transform: scale(0.98);
        }

        /* Verification Controls Mobile */
        .verification-controls-mobile {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .verification-form-mobile {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .verification-form-mobile input {
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            font-size: 16px;
        }

        /* Toast Notifications Mobile */
        .toast-mobile {
            position: fixed;
            top: 100px;
            left: 20px;
            right: 20px;
            padding: 18px 25px;
            border-radius: 15px;
            z-index: 10000;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            color: white;
            font-weight: 600;
            font-size: 16px;
            text-align: center;
            animation: toastSlideIn 0.4s ease-out;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toast-mobile.success {
            background: linear-gradient(45deg, #4caf50, #45a049);
        }

        .toast-mobile.error {
            background: linear-gradient(45deg, #f44336, #e53935);
        }

        /* Floating Action Button */
        .fab-mobile {
            position: fixed;
            bottom: 90px;
            right: 25px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #1a73e8, #764ba2);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(26, 115, 232, 0.4);
            z-index: 100;
            transition: transform 0.2s ease;
            touch-action: manipulation;
        }

        .fab-mobile:active {
            transform: scale(0.95);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            padding: 10px 0 25px;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.1);
            z-index: 50;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            transition: color 0.3s ease;
            touch-action: manipulation;
        }

        .nav-item.active {
            color: #1a73e8;
        }

        .nav-item i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .nav-item span {
            font-size: 12px;
            font-weight: 500;
        }

        /* Android Specific Optimizations */
        @media screen and (max-height: 600px) {
            .auth-container {
                padding: 25px 20px;
            }
            
            .modal-content-mobile {
                max-height: 90vh;
            }
        }

        /* Status Bar Padding for Android */
        @supports (padding-top: env(safe-area-inset-top)) {
            .mobile-top-bar {
                padding-top: calc(15px + env(safe-area-inset-top));
            }
            
            .bottom-nav {
                padding-bottom: calc(25px + env(safe-area-inset-bottom));
            }
        }

        /* Hide scrollbars on mobile */
        .chat-list-mobile::-webkit-scrollbar,
        .messages-container-mobile::-webkit-scrollbar {
            display: none;
        }

        /* Touch feedback */
        .chat-item-mobile:active,
        .message-mobile:active,
        .nav-item:active {
            background-color: rgba(26, 115, 232, 0.1) !important;
        }

        /* Prevent zoom on input focus */
        input[type="text"],
        input[type="email"],
        input[type="password"],
        textarea {
            font-size: 16px !important;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p style="font-size: 18px; margin-top: 10px;">Loading ChatApp Pro...</p>
    </div>

    <!-- Auth Screen -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <div class="auth-header">
                <i class="fas fa-comments"></i>
                <h1>ChatApp Pro</h1>
                <p>Mobile Messaging Platform</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="register">Register</button>
            </div>
            
            <div id="loginForm" class="auth-form active">
                <input type="email" id="loginEmail" placeholder="Email" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button onclick="login()" class="auth-btn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </div>
            
            <div id="registerForm" class="auth-form">
                <input type="text" id="registerName" placeholder="Full Name" required>
                <input type="email" id="registerEmail" placeholder="Email" required>
                <input type="password" id="registerPassword" placeholder="Password" required>
                <input type="text" id="registerUsername" placeholder="Username" required>
                <button onclick="register()" class="auth-btn">
                    <i class="fas fa-user-plus"></i> Register
                </button>
            </div>
            
            <div class="social-auth">
                <button onclick="signInWithGoogle()" class="google-btn">
                    <i class="fab fa-google"></i> Continue with Google
                </button>
            </div>
        </div>
    </div>

    <!-- Main Mobile App -->
    <div id="mainApp" class="main-app">
        <!-- Mobile Top Bar -->
        <div class="mobile-top-bar">
            <div class="top-bar-left">
                <button class="menu-btn" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="app-title">ChatApp Pro</div>
            </div>
            <div class="top-bar-actions">
                <button class="top-action-btn" onclick="showSearch()">
                    <i class="fas fa-search"></i>
                </button>
                <button class="top-action-btn" onclick="showAdminPanel()">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>

        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

        <!-- Mobile Sidebar -->
        <div class="mobile-sidebar" id="mobileSidebar">
            <div class="sidebar-header-mobile">
                <div class="user-profile-mobile">
                    <img id="userAvatarMobile" src="https://via.placeholder.com/50" alt="Avatar" class="avatar-mobile">
                    <div class="user-info-mobile">
                        <h3 id="userNameMobile">User</h3>
                        <p id="userStatusMobile">Online</p>
                    </div>
                    <div class="verification-badge-mobile" id="verificationBadgeMobile" style="display: none;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="sidebar-actions-mobile">
                    <button class="mobile-action-btn" onclick="createGroup()">
                        <i class="fas fa-plus"></i>
                        <span>Create</span>
                    </button>
                    <button class="mobile-action-btn" onclick="showSettings()">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </button>
                    <button class="mobile-action-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
            
            <div class="search-bar-mobile">
                <input type="text" class="search-input-mobile" placeholder="Search chats..." onkeyup="searchChats(this.value)">
            </div>
            
            <div class="chat-list-mobile" id="chatListMobile">
                <!-- Chat items will be populated here -->
            </div>
        </div>

        <!-- Mobile Chat Area -->
        <div class="chat-area-mobile">
            <div class="chat-header-mobile" id="chatHeaderMobile" style="display: none;">
                <div class="chat-info-header">
                    <img id="chatAvatarMobile" src="https://via.placeholder.com/45" alt="Chat Avatar" class="chat-avatar-header">
                    <div class="chat-details">
                        <h3 id="chatNameMobile">Select a chat</h3>
                        <div id="chatStatusMobile" class="chat-status-mobile">Click on a chat to start messaging</div>
                    </div>
                </div>
                <div class="chat-actions-mobile">
                    <button class="chat-action-btn" onclick="addBots()" title="Add Bots">
                        <i class="fas fa-robot"></i>
                    </button>
                    <button class="chat-action-btn" onclick="showMembers()" title="Members">
                        <i class="fas fa-users"></i>
                    </button>
                </div>
            </div>
            
            <div class="messages-container-mobile" id="messagesContainerMobile">
                <div class="welcome-message-mobile">
                    <i class="fas fa-comments"></i>
                    <h2>Welcome to ChatApp Pro</h2>
                    <p>Tap the menu to select a chat and start messaging</p>
                </div>
            </div>
            
            <div class="message-input-area-mobile" id="messageInputAreaMobile">
                <div class="attachment-options-mobile" id="attachmentOptionsMobile">
                    <button onclick="attachPhoto()" class="attach-btn-mobile">
                        <i class="fas fa-camera"></i> Photo
                    </button>
                    <button onclick="attachVideo()" class="attach-btn-mobile">
                        <i class="fas fa-video"></i> Video
                    </button>
                    <button onclick="attachFile()" class="attach-btn-mobile">
                        <i class="fas fa-file"></i> File
                    </button>
                </div>
                
                <div class="message-input-mobile">
                    <button onclick="toggleAttachments()" class="attach-toggle-mobile">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <input type="text" id="messageTextMobile" class="message-text-mobile" placeholder="Type a message..." onkeypress="handleEnterKey(event)">
                    <button onclick="sendMessage()" class="send-btn-mobile">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <input type="file" id="fileInputMobile" accept="image/*,video/*" style="display: none;" onchange="handleFileSelect(event)">
            </div>
        </div>

        <!-- Floating Action Button -->
        <button class="fab-mobile" onclick="createGroup()" style="display: none;">
            <i class="fas fa-plus"></i>
        </button>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showChats()">
                <i class="fas fa-comments"></i>
                <span>Chats</span>
            </div>
            <div class="nav-item" onclick="showChannels()">
                <i class="fas fa-bullhorn"></i>
                <span>Channels</span>
            </div>
            <div class="nav-item" onclick="showContacts()">
                <i class="fas fa-users"></i>
                <span>Contacts</span>
            </div>
            <div class="nav-item" onclick="showAdminPanel()">
                <i class="fas fa-robot"></i>
                <span>Bots</span>
            </div>
        </div>
    </div>

    <!-- Mobile Admin Panel Modal -->
    <div id="adminPanelMobile" class="modal-mobile">
        <div class="modal-content-mobile">
            <div class="modal-header-mobile">
                <h2><i class="fas fa-shield-alt"></i> Admin Panel</h2>
                <button onclick="closeModal('adminPanelMobile')" class="close-btn-mobile">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="admin-tabs-mobile">
                <button class="admin-tab-mobile active" data-tab="users">Users</button>
                <button class="admin-tab-mobile" data-tab="channels">Channels</button>
                <button class="admin-tab-mobile" data-tab="bots">Bots</button>
                <button class="admin-tab-mobile" data-tab="verification">Verify</button>
            </div>
            
            <div id="usersTabMobile" class="admin-tab-content-mobile active">
                <div class="admin-actions-mobile">
                    <button onclick="addFakeFollowers()" class="admin-btn-mobile">
                        <i class="fas fa-user-plus"></i> Add Bot Followers
                    </button>
                    <button onclick="promoteUser()" class="admin-btn-mobile">
                        <i class="fas fa-crown"></i> Promote User
                    </button>
                </div>
                <div id="usersListMobile" class="admin-list"></div>
            </div>
            
            <div id="channelsTabMobile" class="admin-tab-content-mobile">
                <div class="admin-actions-mobile">
                    <button onclick="createChannel()" class="admin-btn-mobile">
                        <i class="fas fa-plus"></i> Create Channel
                    </button>
                    <button onclick="bulkAddBots()" class="admin-btn-mobile">
                        <i class="fas fa-robot"></i> Bulk Add Bots
                    </button>
                </div>
                <div id="channelsListMobile" class="admin-list"></div>
            </div>
            
            <div id="botsTabMobile" class="admin-tab-content-mobile">
                <div class="bot-generator-mobile">
                    <h3>Bot Generator</h3>
                    <label>Number of bots to create:</label>
                    <input type="number" id="botCountMobile" value="100" min="1" max="10000">
                    <button onclick="generateBots()" class="admin-btn-mobile">
                        <i class="fas fa-magic"></i> Generate Bots
                    </button>
                </div>
                <div id="botsListMobile" class="admin-list"></div>
            </div>
            
            <div id="verificationTabMobile" class="admin-tab-content-mobile">
                <div class="verification-controls-mobile">
                    <h3>Blue Tick Verification</h3>
                    <div class="verification-form-mobile">
                        <input type="text" id="verifyUsernameMobile" placeholder="Username to verify">
                        <button onclick="grantVerification()" class="admin-btn-mobile verify-btn-mobile">
                            <i class="fas fa-check-circle"></i> Grant Blue Tick
                        </button>
                        <button onclick="revokeVerification()" class="admin-btn-mobile revoke-btn-mobile">
                            <i class="fas fa-times-circle"></i> Revoke Verification
                        </button>
                    </div>
                </div>
                <div id="verifiedUsersListMobile" class="admin-list"></div>
            </div>
        </div>
    </div>

    <!-- Create Group Mobile Modal -->
    <div id="createGroupModalMobile" class="modal-mobile">
        <div class="modal-content-mobile">
            <div class="modal-header-mobile">
                <h2><i class="fas fa-users"></i> Create Group/Channel</h2>
                <button onclick="closeModal('createGroupModalMobile')" class="close-btn-mobile">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="padding: 25px;">
                <div class="form-group-mobile">
                    <label>Type:</label>
                    <select id="groupTypeMobile">
                        <option value="group">Group Chat</option>
                        <option value="channel">Channel</option>
                    </select>
                </div>
                
                <div class="form-group-mobile">
                    <label>Name:</label>
                    <input type="text" id="groupNameMobile" placeholder="Enter group/channel name">
                </div>
                
                <div class="form-group-mobile">
                    <label>Description:</label>
                    <textarea id="groupDescriptionMobile" placeholder="Enter description"></textarea>
                </div>
                
                <div class="form-group-mobile">
                    <label>Privacy:</label>
                    <select id="groupPrivacyMobile">
                        <option value="public">Public</option>
                        <option value="private">Private</option>
                    </select>
                </div>
                
                <button onclick="submitGroupCreation()" class="submit-btn-mobile">
                    <i class="fas fa-plus"></i> Create
                </button>
            </div>
        </div>
    </div>

    <!-- Members Mobile Modal -->
    <div id="membersModalMobile" class="modal-mobile">
        <div class="modal-content-mobile">
            <div class="modal-header-mobile">
                <h2><i class="fas fa-users"></i> Members</h2>
                <button onclick="closeModal('membersModalMobile')" class="close-btn-mobile">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="membersListMobile" style="padding: 25px;"></div>
        </div>
    </div>

    <script>
        // MOBILE-OPTIMIZED JAVASCRIPT
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAL5e-5eQfgf1nI6hWTnhwLFgK0Cp89aa0",
            authDomain: "aviator-pr01.firebaseapp.com",
            databaseURL: "https://aviator-pr01-default-rtdb.firebaseio.com",
            projectId: "aviator-pr01",
            storageBucket: "aviator-pr01.firebasestorage.app",
            messagingSenderId: "290788041297",
            appId: "1:290788041297:web:168f99d1532997fb778e70",
            measurementId: "G-ENCBTT4BL8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Initialize Firebase services
        const auth = firebase.auth();
        const database = firebase.database();
        const firestore = firebase.firestore();

        // Global variables
        let currentUser = null;
        let currentChat = null;
        let isAdmin = false;
        let isSidebarOpen = false;

        // Bot names for generating fake users
        const botNames = [
            'Alex Johnson', 'Maria Garcia', 'David Wilson', 'Sarah Brown', 'Michael Davis',
            'Jessica Miller', 'Christopher Wilson', 'Amanda Johnson', 'Matthew Taylor', 'Ashley Anderson',
            'Joshua Jackson', 'Brittany White', 'Andrew Thomas', 'Samantha Harris', 'Justin Martin',
            'Megan Thompson', 'Ryan Garcia', 'Lauren Martinez', 'Brandon Rodriguez', 'Kayla Lewis',
            'Tyler Lee', 'Nicole Walker', 'Kevin Hall', 'Danielle Allen', 'Jose Young',
            'Stephanie Hernandez', 'Jacob King', 'Rachel Wright', 'Aaron Lopez', 'Christina Hill',
            'Zachary Scott', 'Michelle Green', 'Nathan Adams', 'Kimberly Baker', 'Caleb Gonzalez',
            'Amy Nelson', 'Noah Carter', 'Elizabeth Mitchell', 'Ethan Perez', 'Melissa Roberts',
            'Lucas Turner', 'Laura Phillips', 'Mason Campbell', 'Rebecca Parker', 'Logan Evans',
            'Anna Edwards', 'Hunter Collins', 'Victoria Stewart', 'Connor Sanchez', 'Olivia Morris'
        ];

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            showLoadingScreen();
            
            // Setup auth tab switching
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', () => switchAuthTab(tab.dataset.tab));
            });

            // Setup admin tab switching
            document.querySelectorAll('.admin-tab-mobile').forEach(tab => {
                tab.addEventListener('click', () => switchAdminTab(tab.dataset.tab));
            });

            // Setup bottom navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Check authentication state
            auth.onAuthStateChanged(function(user) {
                hideLoadingScreen();
                if (user) {
                    currentUser = user;
                    checkAdminStatus();
                    showMainApp();
                    loadUserData();
                    loadChats();
                } else {
                    showAuthScreen();
                }
            });

            // Touch events for better mobile interaction
            setupTouchEvents();
        });

        // Mobile-specific functions
        function setupTouchEvents() {
            // Prevent double-tap zoom
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);

            // Swipe to close sidebar
            let startX = null;
            let startY = null;

            document.addEventListener('touchstart', function(e) {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            });

            document.addEventListener('touchmove', function(e) {
                if (!startX || !startY) return;

                let diffX = startX - e.touches[0].clientX;
                let diffY = startY - e.touches[0].clientY;

                if (Math.abs(diffX) > Math.abs(diffY)) {
                    if (diffX > 50 && isSidebarOpen) {
                        closeSidebar();
                    }
                }

                startX = null;
                startY = null;
            });
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('mobileSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (isSidebarOpen) {
                closeSidebar();
            } else {
                sidebar.classList.add('active');
                overlay.classList.add('active');
                isSidebarOpen = true;
            }
        }

        function closeSidebar() {
            const sidebar = document.getElementById('mobileSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            isSidebarOpen = false;
        }

        // Show/Hide screens
        function showLoadingScreen() {
            document.getElementById('loadingScreen').style.display = 'flex';
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'none';
        }

        function hideLoadingScreen() {
            document.getElementById('loadingScreen').style.display = 'none';
        }

        function showAuthScreen() {
            document.getElementById('authScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }

        function showMainApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
        }

        // Authentication Functions
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            document.getElementById(`${tab}Form`).classList.add('active');
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showSuccessMessage('Login successful!');
            } catch (error) {
                showErrorMessage(error.message);
            }
        }

        async function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const username = document.getElementById('registerUsername').value;
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                await user.updateProfile({
                    displayName: name
                });
                
                await database.ref(`users/${user.uid}`).set({
                    name: name,
                    email: email,
                    username: username,
                    avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=1a73e8&color=fff`,
                    isVerified: false,
                    isBot: false,
                    followers: 0,
                    following: 0,
                    joinedAt: Date.now(),
                    lastSeen: Date.now(),
                    status: 'online'
                });
                
                showSuccessMessage('Registration successful!');
            } catch (error) {
                showErrorMessage(error.message);
            }
        }

        async function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                const userRef = database.ref(`users/${user.uid}`);
                const snapshot = await userRef.once('value');
                
                if (!snapshot.exists()) {
                    await userRef.set({
                        name: user.displayName,
                        email: user.email,
                        username: user.email.split('@')[0],
                        avatar: user.photoURL,
                        isVerified: false,
                        isBot: false,
                        followers: 0,
                        following: 0,
                        joinedAt: Date.now(),
                        lastSeen: Date.now(),
                        status: 'online'
                    });
                }
                
                showSuccessMessage('Google sign-in successful!');
            } catch (error) {
                showErrorMessage(error.message);
            }
        }

        function logout() {
            auth.signOut();
        }

        // User Data Functions
        async function loadUserData() {
            if (!currentUser) return;
            
            const userSnapshot = await database.ref(`users/${currentUser.uid}`).once('value');
            const userData = userSnapshot.val();
            
            if (userData) {
                document.getElementById('userNameMobile').textContent = userData.name;
                document.getElementById('userAvatarMobile').src = userData.avatar;
                document.getElementById('userStatusMobile').textContent = userData.status;
                
                const badge = document.getElementById('verificationBadgeMobile');
                if (userData.isVerified) {
                    badge.style.display = 'block';
                } else {
                    badge.style.display = 'none';
                }
                
                await database.ref(`users/${currentUser.uid}/lastSeen`).set(Date.now());
            }
        }

        async function checkAdminStatus() {
            if (!currentUser) return;
            
            const adminSnapshot = await database.ref(`admins/${currentUser.uid}`).once('value');
            isAdmin = adminSnapshot.exists();
        }

        // Chat Functions
        async function loadChats() {
            const chatList = document.getElementById('chatListMobile');
            chatList.innerHTML = '';
            
            const userChatsRef = database.ref(`userChats/${currentUser.uid}`);
            userChatsRef.on('value', async (snapshot) => {
                const userChats = snapshot.val() || {};
                
                for (const chatId in userChats) {
                    const chatSnapshot = await database.ref(`chats/${chatId}`).once('value');
                    const chatData = chatSnapshot.val();
                    
                    if (chatData) {
                        const chatElement = createChatElementMobile(chatId, chatData);
                        chatList.appendChild(chatElement);
                    }
                }
            });
            
            await createDefaultChannels();
        }

        function createChatElementMobile(chatId, chatData) {
            const div = document.createElement('div');
            div.className = 'chat-item-mobile';
            div.onclick = () => openChatMobile(chatId, chatData);
            
            const lastMessage = chatData.lastMessage || 'No messages yet';
            const memberCount = chatData.members ? Object.keys(chatData.members).length : 0;
            
            div.innerHTML = `
                <img src="${chatData.avatar || 'https://via.placeholder.com/55'}" alt="Chat" class="chat-avatar-mobile">
                <div class="chat-info-mobile">
                    <div class="chat-name-mobile">
                        ${chatData.name}
                        ${chatData.type === 'channel' ? '<i class="fas fa-bullhorn" style="color: #1da1f2;"></i>' : ''}
                        ${chatData.isVerified ? '<i class="fas fa-check-circle" style="color: #1da1f2;"></i>' : ''}
                    </div>
                    <div class="chat-last-message-mobile">${lastMessage}</div>
                </div>
                <div class="chat-meta-mobile">
                    <div class="chat-time-mobile">${formatTime(chatData.lastMessageTime)}</div>
                    <div class="member-count-mobile">${memberCount} members</div>
                </div>
            `;
            
            return div;
        }

        async function openChatMobile(chatId, chatData) {
            currentChat = chatId;
            
            // Close sidebar
            closeSidebar();
            
            // Update chat header
            document.getElementById('chatNameMobile').textContent = chatData.name;
            document.getElementById('chatAvatarMobile').src = chatData.avatar || 'https://via.placeholder.com/45';
            document.getElementById('chatStatusMobile').textContent = `${Object.keys(chatData.members || {}).length} members`;
            
            // Show chat header and input
            document.getElementById('chatHeaderMobile').style.display = 'flex';
            document.getElementById('messageInputAreaMobile').style.display = 'block';
            
            // Load messages
            loadMessagesMobile(chatId);
            
            // Clear welcome message
            const welcomeMsg = document.querySelector('.welcome-message-mobile');
            if (welcomeMsg) welcomeMsg.style.display = 'none';
        }

        function loadMessagesMobile(chatId) {
            const messagesContainer = document.getElementById('messagesContainerMobile');
            messagesContainer.innerHTML = '';
            
            const messagesRef = database.ref(`messages/${chatId}`);
            messagesRef.limitToLast(50).on('child_added', (snapshot) => {
                const message = snapshot.val();
                const messageElement = createMessageElementMobile(message);
                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            });
        }

        function createMessageElementMobile(message) {
            const div = document.createElement('div');
            div.className = `message-mobile ${message.senderId === currentUser.uid ? 'sent' : 'received'}`;
            
            const messageContent = message.type === 'text' ? message.text : 
                                  message.type === 'image' ? `<img src="${message.url}" alt="Image" class="message-media-mobile">` :
                                  message.type === 'video' ? `<video src="${message.url}" controls class="message-media-mobile"></video>` :
                                  message.text;
            
            div.innerHTML = `
                <div class="message-header-mobile">
                    <img src="${message.senderAvatar}" alt="Avatar" class="message-avatar-mobile">
                    <span class="message-sender-mobile">${message.senderName}</span>
                    ${message.senderVerified ? '<i class="fas fa-check-circle verified-badge-mobile"></i>' : ''}
                    <span class="message-time-mobile">${formatTime(message.timestamp)}</span>
                </div>
                <div class="message-content-mobile">${messageContent}</div>
            `;
            
            return div;
        }

        async function sendMessage() {
            if (!currentChat) return;
            
            const messageText = document.getElementById('messageTextMobile').value.trim();
            if (!messageText) return;
            
            const userSnapshot = await database.ref(`users/${currentUser.uid}`).once('value');
            const userData = userSnapshot.val();
            
            const message = {
                text: messageText,
                senderId: currentUser.uid,
                senderName: userData.name,
                senderAvatar: userData.avatar,
                senderVerified: userData.isVerified || false,
                timestamp: Date.now(),
                type: 'text'
            };
            
            await database.ref(`messages/${currentChat}`).push(message);
            await database.ref(`chats/${currentChat}`).update({
                lastMessage: messageText,
                lastMessageTime: Date.now()
            });
            
            document.getElementById('messageTextMobile').value = '';
        }

        function handleEnterKey(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Media Functions
        function toggleAttachments() {
            const options = document.getElementById('attachmentOptionsMobile');
            options.style.display = options.style.display === 'flex' ? 'none' : 'flex';
        }

        function attachPhoto() {
            const fileInput = document.getElementById('fileInputMobile');
            fileInput.accept = 'image/*';
            fileInput.click();
        }

        function attachVideo() {
            const fileInput = document.getElementById('fileInputMobile');
            fileInput.accept = 'video/*';
            fileInput.click();
        }

        function attachFile() {
            const fileInput = document.getElementById('fileInputMobile');
            fileInput.accept = '*/*';
            fileInput.click();
        }

        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!currentChat) {
                showErrorMessage('Please select a chat first');
                return;
            }
            
            try {
                showSuccessMessage('Uploading file...');
                
                const uploadUrl = await uploadToDataURL(file);
                
                const userSnapshot = await database.ref(`users/${currentUser.uid}`).once('value');
                const userData = userSnapshot.val();
                
                const message = {
                    text: file.name,
                    url: uploadUrl,
                    senderId: currentUser.uid,
                    senderName: userData.name,
                    senderAvatar: userData.avatar,
                    senderVerified: userData.isVerified || false,
                    timestamp: Date.now(),
                    type: file.type.startsWith('image/') ? 'image' : file.type.startsWith('video/') ? 'video' : 'file'
                };
                
                await database.ref(`messages/${currentChat}`).push(message);
                await database.ref(`chats/${currentChat}`).update({
                    lastMessage: ` ${file.name}`,
                    lastMessageTime: Date.now()
                });
                
                showSuccessMessage('File uploaded successfully!');
            } catch (error) {
                showErrorMessage('Failed to upload file: ' + error.message);
            }
            
            event.target.value = '';
            toggleAttachments();
        }

        async function uploadToDataURL(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.readAsDataURL(file);
            });
        }

        // Group/Channel Functions
        function createGroup() {
            document.getElementById('createGroupModalMobile').style.display = 'flex';
        }

        async function submitGroupCreation() {
            const type = document.getElementById('groupTypeMobile').value;
            const name = document.getElementById('groupNameMobile').value;
            const description = document.getElementById('groupDescriptionMobile').value;
            const privacy = document.getElementById('groupPrivacyMobile').value;
            
            if (!name.trim()) {
                showErrorMessage('Group name is required');
                return;
            }
            
            try {
                const chatId = Date.now().toString();
                const chatData = {
                    name: name,
                    description: description,
                    type: type,
                    privacy: privacy,
                    avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=random`,
                    createdBy: currentUser.uid,
                    createdAt: Date.now(),
                    members: {
                        [currentUser.uid]: {
                            role: 'admin',
                            joinedAt: Date.now()
                        }
                    }
                };
                
                await database.ref(`chats/${chatId}`).set(chatData);
                await database.ref(`userChats/${currentUser.uid}/${chatId}`).set(true);
                
                if (type === 'channel') {
                    await addBotsToChat(chatId, 50);
                }
                
                closeModal('createGroupModalMobile');
                showSuccessMessage(`${type} created successfully!`);
                
                document.getElementById('groupNameMobile').value = '';
                document.getElementById('groupDescriptionMobile').value = '';
            } catch (error) {
                showErrorMessage('Failed to create group: ' + error.message);
            }
        }

        // Admin Panel Functions
        function showAdminPanel() {
            if (!isAdmin) {
                showErrorMessage('Access denied. Admin privileges required.');
                return;
            }
            
            document.getElementById('adminPanelMobile').style.display = 'flex';
            loadAdminDataMobile();
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab-mobile').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-tab-content-mobile').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            document.getElementById(`${tab}TabMobile`).classList.add('active');
        }

        async function loadAdminDataMobile() {
            const usersSnapshot = await database.ref('users').once('value');
            const users = usersSnapshot.val() || {};
            
            const usersList = document.getElementById('usersListMobile');
            usersList.innerHTML = '';
            
            Object.entries(users).slice(0, 20).forEach(([uid, userData]) => {
                const userElement = document.createElement('div');
                userElement.className = 'admin-list-item';
                userElement.style.cssText = `
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    padding: 15px;
                    border: 1px solid #e9ecef;
                    border-radius: 12px;
                    margin-bottom: 10px;
                    background: #f8f9fa;
                `;
                userElement.innerHTML = `
                    <img src="${userData.avatar}" alt="Avatar" style="width: 45px; height: 45px; border-radius: 50%;">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 5px;">${userData.name} ${userData.isVerified ? '<i class="fas fa-check-circle" style="color: #1da1f2;"></i>' : ''}</div>
                        <div style="font-size: 13px; color: #666;">@${userData.username}  ${userData.followers || 0} followers</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 5px;">
                        <button onclick="toggleVerification('${uid}')" style="padding: 6px 12px; background: #e9ecef; border: 1px solid #dee2e6; border-radius: 6px; font-size: 12px; cursor: pointer;">
                            ${userData.isVerified ? 'Remove' : 'Add'} Tick
                        </button>
                        ${userData.isBot ? '<span style="background: #fd7e14; color: white; padding: 3px 6px; border-radius: 8px; font-size: 10px;">BOT</span>' : ''}
                    </div>
                `;
                usersList.appendChild(userElement);
            });
        }

        async function generateBots() {
            const count = parseInt(document.getElementById('botCountMobile').value) || 100;
            
            try {
                showSuccessMessage(`Generating ${count} bots...`);
                
                for (let i = 0; i < count; i++) {
                    const name = botNames[Math.floor(Math.random() * botNames.length)];
                    const username = `bot_${name.toLowerCase().replace(' ', '_')}_${Math.floor(Math.random() * 10000)}`;
                    const avatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=random`;
                    
                    const botData = {
                        name: name,
                        username: username,
                        email: `${username}@botmail.com`,
                        avatar: avatar,
                        isBot: true,
                        isVerified: Math.random() > 0.8,
                        followers: Math.floor(Math.random() * 10000),
                        following: Math.floor(Math.random() * 1000),
                        joinedAt: Date.now() - Math.floor(Math.random() * 365 * 24 * 60 * 60 * 1000),
                        lastSeen: Date.now() - Math.floor(Math.random() * 7 * 24 * 60 * 60 * 1000),
                        status: Math.random() > 0.3 ? 'online' : 'offline'
                    };
                    
                    await database.ref(`users/bot_${Date.now()}_${i}`).set(botData);
                }
                
                showSuccessMessage(`${count} bots generated successfully!`);
                loadAdminDataMobile();
            } catch (error) {
                showErrorMessage('Failed to generate bots: ' + error.message);
            }
        }

        async function addBotsToChat(chatId, count = 100) {
            const botsSnapshot = await database.ref('users').orderByChild('isBot').equalTo(true).limitToFirst(count).once('value');
            const bots = botsSnapshot.val() || {};
            
            const updates = {};
            Object.keys(bots).forEach(botId => {
                updates[`chats/${chatId}/members/${botId}`] = {
                    role: 'member',
                    joinedAt: Date.now()
                };
                updates[`userChats/${botId}/${chatId}`] = true;
            });
            
            await database.ref().update(updates);
        }

        async function grantVerification() {
            const username = document.getElementById('verifyUsernameMobile').value.trim();
            if (!username) return;
            
            try {
                const usersSnapshot = await database.ref('users').orderByChild('username').equalTo(username).once('value');
                const users = usersSnapshot.val();
                
                if (!users) {
                    showErrorMessage('User not found');
                    return;
                }
                
                const userId = Object.keys(users)[0];
                await database.ref(`users/${userId}/isVerified`).set(true);
                
                showSuccessMessage(`Blue tick granted to @${username}!`);
                document.getElementById('verifyUsernameMobile').value = '';
                loadAdminDataMobile();
            } catch (error) {
                showErrorMessage('Failed to grant verification: ' + error.message);
            }
        }

        async function revokeVerification() {
            const username = document.getElementById('verifyUsernameMobile').value.trim();
            if (!username) return;
            
            try {
                const usersSnapshot = await database.ref('users').orderByChild('username').equalTo(username).once('value');
                const users = usersSnapshot.val();
                
                if (!users) {
                    showErrorMessage('User not found');
                    return;
                }
                
                const userId = Object.keys(users)[0];
                await database.ref(`users/${userId}/isVerified`).set(false);
                
                showSuccessMessage(`Blue tick revoked from @${username}!`);
                document.getElementById('verifyUsernameMobile').value = '';
                loadAdminDataMobile();
            } catch (error) {
                showErrorMessage('Failed to revoke verification: ' + error.message);
            }
        }

        async function toggleVerification(userId) {
            try {
                const userSnapshot = await database.ref(`users/${userId}`).once('value');
                const userData = userSnapshot.val();
                
                const newStatus = !userData.isVerified;
                await database.ref(`users/${userId}/isVerified`).set(newStatus);
                
                showSuccessMessage(`Verification ${newStatus ? 'granted' : 'revoked'}!`);
                loadAdminDataMobile();
            } catch (error) {
                showErrorMessage('Failed to toggle verification: ' + error.message);
            }
        }

        // Create default channels with bots
        async function createDefaultChannels() {
            const defaultChannels = [
                { name: 'General Chat', description: 'General discussion channel' },
                { name: 'Tech News', description: 'Latest technology news and updates' },
                { name: 'Gaming Zone', description: 'Gaming discussions and tips' },
                { name: 'Music Lovers', description: 'Share and discuss music' }
            ];
            
            for (const channel of defaultChannels) {
                const chatId = `default_${channel.name.toLowerCase().replace(' ', '_')}`;
                
                const existingChannel = await database.ref(`chats/${chatId}`).once('value');
                if (existingChannel.exists()) continue;
                
                const chatData = {
                    name: channel.name,
                    description: channel.description,
                    type: 'channel',
                    privacy: 'public',
                    avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(channel.name)}&background=random`,
                    createdBy: 'system',
                    createdAt: Date.now(),
                    isVerified: true,
                    members: {
                        [currentUser.uid]: {
                            role: 'member',
                            joinedAt: Date.now()
                        }
                    }
                };
                
                await database.ref(`chats/${chatId}`).set(chatData);
                await database.ref(`userChats/${currentUser.uid}/${chatId}`).set(true);
                await addBotsToChat(chatId, Math.floor(Math.random() * 500) + 100);
            }
        }

        // Utility Functions
        function showSuccessMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'toast-mobile success';
            toast.textContent = message;
            
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        function showErrorMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'toast-mobile error';
            toast.textContent = message;
            
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        function formatTime(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h';
            return Math.floor(diff / 86400000) + 'd';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function searchChats(query) {
            const chatItems = document.querySelectorAll('.chat-item-mobile');
            chatItems.forEach(item => {
                const chatName = item.querySelector('.chat-name-mobile').textContent.toLowerCase();
                item.style.display = chatName.includes(query.toLowerCase()) ? 'flex' : 'none';
            });
        }

        function showMembers() {
            if (!currentChat) return;
            document.getElementById('membersModalMobile').style.display = 'flex';
        }

        // Bottom navigation functions
        function showChats() {
            closeSidebar();
            // Filter to show only direct messages
        }

        function showChannels() {
            closeSidebar();
            // Filter to show only channels
        }

        function showContacts() {
            closeSidebar();
            showErrorMessage('Contacts feature coming soon!');
        }

        function showSearch() {
            showErrorMessage('Search feature coming soon!');
        }

        function showSettings() {
            showErrorMessage('Settings feature coming soon!');
        }

        // Additional functions for compatibility
        function addBots() {
            if (!currentChat) {
                showErrorMessage('Please select a chat first');
                return;
            }
            
            const count = prompt('How many bots to add?', '100');
            if (count && !isNaN(count)) {
                addBotsToChat(currentChat, parseInt(count));
                showSuccessMessage(`${count} bots will be added to the chat!`);
            }
        }

        function bulkAddBots() {
            if (!currentChat) {
                showErrorMessage('Please select a chat first');
                return;
            }
            
            addBotsToChat(currentChat, 1000);
            showSuccessMessage('1000 bots added to the chat!');
        }

        function addFakeFollowers() {
            const count = prompt('How many fake followers to add?', '1000');
            if (count && !isNaN(count)) {
                showSuccessMessage(`${count} fake followers added!`);
            }
        }

        function promoteUser() {
            const username = prompt('Enter username to promote:');
            if (username) {
                showSuccessMessage(`User @${username} promoted to admin!`);
            }
        }

        function createChannel() {
            createGroup();
        }
    </script>
</body>
</html>